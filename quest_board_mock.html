<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest Board - Mock</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
        }

        .quest-board-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .quest-board-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .quest-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .quest-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .quest-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .quest-description {
            color: #666;
            margin-bottom: 10px;
        }

        .quest-status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .quest-status.active {
            background: #4caf50;
            color: white;
        }

        .quest-status.pending {
            background: #ff9800;
            color: white;
        }

        .quest-status.completed {
            background: #2196f3;
            color: white;
        }

        .quest-category {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
            margin-right: 10px;
            text-transform: uppercase;
        }

        .category-cardio {
            background: #e3f2fd;
            color: #1976d2;
        }

        .category-strength {
            background: #fce4ec;
            color: #c2185b;
        }

        .category-flexibility {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .category-wellness {
            background: #e8f5e9;
            color: #388e3c;
        }

        .complete-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
            transition: background 0.3s;
        }

        .complete-btn:hover {
            background: #45a049;
        }

        .complete-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }

        .refresh-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 20px;
            font-size: 16px;
        }

        .refresh-btn:hover {
            background: #5568d3;
        }

        .coin-display {
            background: #ffd700;
            color: #333;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 18px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .shop-btn {
            background: #ff9800;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            margin-left: 10px;
        }

        .shop-btn:hover {
            background: #f57c00;
        }

        .shop-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .shop-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 10px;
            width: 80%;
            max-width: 900px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .shop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 15px;
        }

        .shop-close {
            font-size: 32px;
            font-weight: bold;
            color: #999;
            cursor: pointer;
            transition: color 0.3s;
        }

        .shop-close:hover {
            color: #333;
        }

        .shop-section {
            margin-bottom: 30px;
        }

        .shop-section h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .shop-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .shop-item {
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .shop-item:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .shop-item.owned {
            border-color: #4caf50;
            background: #e8f5e9;
        }

        .shop-item.equipped {
            border-color: #ffd700;
            background: #fffde7;
        }

        .shop-item-emoji {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .shop-item-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .shop-item-price {
            color: #ffd700;
            font-weight: bold;
            font-size: 16px;
        }

        .buy-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            font-weight: bold;
        }

        .buy-btn:hover {
            background: #45a049;
        }

        .buy-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .equip-btn {
            background: #2196f3;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            font-weight: bold;
        }

        .equip-btn:hover {
            background: #1976d2;
        }

        .profile-avatar {
            font-size: 48px;
            margin-right: 10px;
        }

        .profile-title {
            color: #667eea;
            font-weight: bold;
            margin-left: 10px;
        }

        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header h2 {
            color: #667eea;
            margin: 0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            box-sizing: border-box;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-login {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.3s;
        }

        .btn-login:hover {
            opacity: 0.9;
        }

        .signup-link {
            text-align: center;
            margin-top: 20px;
            color: #666;
        }

        .signup-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: bold;
        }

        .signup-link a:hover {
            text-decoration: underline;
        }

        .error-message {
            color: #f44336;
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
        }

        #main-content {
            display: none;
        }

        .user-profile-details-style {
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            padding: 10px; 
            background: #bdc4cc; 
            color: #171010;
        }
    </style>
</head>
<body>

<!-- Login Page -->
<div id="login-page">
    <div class="login-container">
        <div class="login-header">
            <h2>ðŸŽ¯ Quest Board Login</h2>
            <p style="color: #666; margin-top: 10px;">Sign in to view your quests</p>
        </div>
        <form id="loginForm">
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" name="username" required placeholder="Enter your username">
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" name="password" required placeholder="Enter your password">
            </div>
            <button type="submit" class="btn-login">Login</button>
            <div class="error-message" id="error-message"></div>
        </form>
        <div class="signup-link">
            Don't have an account? <a href="#" id="signup-link">Sign up</a>
        </div>
    </div>
</div>

<!-- Main Quest Board (Hidden until login) -->
<div id="main-content">
    <div class="quest-board-header">
        <h1 style="margin: 0; font-size: 32px;">ðŸ’ª Daily Health Quest Board</h1>
        <p style="margin: 10px 0 0 0; opacity: 0.9;">Complete daily fitness and wellness challenges</p>
    </div>

    <div class="user-profile-details-style" style="padding: 15px; background: #f5f5f5;">
        <div style="display: flex; align-items: center; justify-content: space-between;">
            <div style="display: flex; align-items: center;">
                <span class="profile-avatar" id="user-avatar">ðŸ‘¤</span>
                <div>
                    <span id="user_status">Welcome, Adventurer!</span>
                    <span class="profile-title" id="user-title"></span>
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
                <div class="coin-display">
                    <span>ðŸ’°</span>
                    <span id="coin-count">0</span>
                    <span>coins</span>
                </div>
                <button id="shop-btn" class="shop-btn">ðŸ›’ Shop</button>
                <button id="logout-btn" style="padding: 8px 20px; background: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer;">Logout</button>
            </div>
        </div>
    </div>

    <div class="quest-board-container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="color: #333; margin: 0;">Your Daily Health Quests</h2>
            <button id="refresh-quests" class="refresh-btn">ðŸ”„ Get New Quests</button>
        </div>
        <div id="quest-list">
            <!-- Quests will be loaded here dynamically -->
        </div>
    </div>
</div>

<!-- Shop Modal -->
<div id="shop-modal" class="shop-modal">
    <div class="shop-content">
        <div class="shop-header">
            <h2 style="margin: 0;">ðŸ›’ Quest Shop</h2>
            <span class="shop-close" id="shop-close">&times;</span>
        </div>
        
        <div style="text-align: center; margin-bottom: 30px;">
            <div class="coin-display" style="font-size: 24px;">
                <span>ðŸ’°</span>
                <span id="shop-coin-count">0</span>
                <span>coins</span>
            </div>
        </div>

        <div class="shop-section">
            <h3>ðŸŽ­ Avatars</h3>
            <div class="shop-items" id="avatars-grid">
                <!-- Avatars will be loaded here -->
            </div>
        </div>

        <div class="shop-section">
            <h3>âœ¨ Cosmetics</h3>
            <div class="shop-items" id="cosmetics-grid">
                <!-- Cosmetics will be loaded here -->
            </div>
        </div>

        <div class="shop-section">
            <h3>ðŸ“¦ VIP Crates</h3>
            <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Special crates with random rewards! VIP level required to open.</p>
            <div class="shop-items" id="crates-grid">
                <!-- VIP Crates will be loaded here -->
            </div>
        </div>
    </div>
</div>

<script>
    // Mock data for quests
    const MOCK_QUESTS = [
        {
            quest_id: 1,
            title: "Running Challenge",
            description: "Complete 25 minutes of running",
            category: "cardio",
            status: "active"
        },
        {
            quest_id: 2,
            title: "Push-ups Challenge",
            description: "Complete 30 reps of push-ups",
            category: "strength",
            status: "active"
        },
        {
            quest_id: 3,
            title: "Yoga session Challenge",
            description: "Complete 20 minutes of yoga session",
            category: "flexibility",
            status: "active"
        },
        {
            quest_id: 4,
            title: "Drink water Challenge",
            description: "Complete 8 glasses of drink water",
            category: "wellness",
            status: "active"
        },
        {
            quest_id: 5,
            title: "Squats Challenge",
            description: "Complete 45 reps of squats",
            category: "strength",
            status: "active"
        },
        {
            quest_id: 6,
            title: "Walking Challenge",
            description: "Complete 30 minutes of walking",
            category: "cardio",
            status: "active"
        }
    ];

    // Mock data for shop
    const MOCK_SHOP = {
        avatars: [
            {id: "avatar_1", name: "Fitness Pro", emoji: "ðŸ‹ï¸", price: 50, type: "avatar"},
            {id: "avatar_2", name: "Yoga Master", emoji: "ðŸ§˜", price: 50, type: "avatar"},
            {id: "avatar_3", name: "Runner", emoji: "ðŸƒ", price: 50, type: "avatar"},
            {id: "avatar_4", name: "Cyclist", emoji: "ðŸš´", price: 75, type: "avatar"},
            {id: "avatar_5", name: "Swimmer", emoji: "ðŸŠ", price: 75, type: "avatar"},
            {id: "avatar_6", name: "Champion", emoji: "ðŸ†", price: 100, type: "avatar"},
            {id: "avatar_7", name: "Martial Artist", emoji: "ðŸ¥‹", price: 100, type: "avatar"},
            {id: "avatar_8", name: "Boxer", emoji: "ðŸ¥Š", price: 100, type: "avatar"}
        ],
        cosmetics: [
            {id: "border_1", name: "Gold Border", emoji: "âœ¨", price: 30, type: "border", color: "#ffd700"},
            {id: "border_2", name: "Silver Border", emoji: "â­", price: 20, type: "border", color: "#c0c0c0"},
            {id: "border_3", name: "Bronze Border", emoji: "ðŸ”¶", price: 10, type: "border", color: "#cd7f32"},
            {id: "border_4", name: "Rainbow Border", emoji: "ðŸŒˆ", price: 150, type: "border", color: "linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #8b00ff)"},
            {id: "title_1", name: "Beginner", emoji: "ðŸŒ±", price: 5, type: "title"},
            {id: "title_2", name: "Warrior", emoji: "âš”ï¸", price: 50, type: "title"},
            {id: "title_3", name: "Legend", emoji: "ðŸ‘‘", price: 100, type: "title"},
            {id: "title_4", name: "Master", emoji: "ðŸŽ–ï¸", price: 200, type: "title"}
        ],
        vip_crates: [
            {id: "bronze_crate", name: "Bronze VIP Crate", emoji: "ðŸ“¦", price: 100, type: "crate", vip_required: 1, description: "Basic VIP crate with common rewards"},
            {id: "silver_crate", name: "Silver VIP Crate", emoji: "ðŸŽ", price: 250, type: "crate", vip_required: 2, description: "Advanced VIP crate with uncommon and rare rewards"},
            {id: "gold_crate", name: "Gold VIP Crate", emoji: "ðŸ†", price: 500, type: "crate", vip_required: 3, description: "Premium VIP crate with epic and legendary rewards"},
            {id: "platinum_crate", name: "Platinum VIP Crate", emoji: "ðŸ’«", price: 1000, type: "crate", vip_required: 5, description: "Ultimate VIP crate with guaranteed legendary rewards"}
        ]
    };

    // VIP Crate rewards system - Complete data from quest_board.py
    const VIP_CRATES = {
        bronze_crate: {
            rewards: [
                {item: "Common Avatar", type: "avatar", emoji: "ðŸ‘¤", probability: 0.50, rarity: "common"},
                {item: "Basic Border", type: "border", emoji: "â¬œ", probability: 0.30, rarity: "common"},
                {item: "50 Bonus Points", type: "points", emoji: "ðŸ’°", value: 50, probability: 0.15, rarity: "uncommon"},
                {item: "Epic Title", type: "title", emoji: "ðŸŽ¯", probability: 0.05, rarity: "rare"}
            ]
        },
        silver_crate: {
            rewards: [
                {item: "Rare Avatar", type: "avatar", emoji: "ðŸ¦¸", probability: 0.40, rarity: "uncommon"},
                {item: "Premium Border", type: "border", emoji: "ðŸ”·", probability: 0.30, rarity: "uncommon"},
                {item: "150 Bonus Points", type: "points", emoji: "ðŸ’Ž", value: 150, probability: 0.20, rarity: "rare"},
                {item: "Legendary Title", type: "title", emoji: "ðŸ‘‘", probability: 0.08, rarity: "epic"},
                {item: "Mystery Reward", type: "special", emoji: "â“", probability: 0.02, rarity: "legendary"}
            ]
        },
        gold_crate: {
            rewards: [
                {item: "Epic Avatar", type: "avatar", emoji: "ðŸŒŸ", probability: 0.35, rarity: "rare"},
                {item: "Diamond Border", type: "border", emoji: "ðŸ’ ", probability: 0.25, rarity: "epic"},
                {item: "300 Bonus Points", type: "points", emoji: "ðŸ”¥", value: 300, probability: 0.20, rarity: "epic"},
                {item: "Ultimate Title", type: "title", emoji: "âš¡", probability: 0.15, rarity: "epic"},
                {item: "Exclusive Avatar Pack", type: "avatar_pack", emoji: "ðŸŽ­", probability: 0.04, rarity: "legendary"},
                {item: "Jackpot 1000 Points", type: "points", emoji: "ðŸ’¸", value: 1000, probability: 0.01, rarity: "legendary"}
            ]
        },
        platinum_crate: {
            rewards: [
                {item: "Legendary Avatar", type: "avatar", emoji: "ðŸ”±", probability: 0.30, rarity: "legendary"},
                {item: "Cosmic Border", type: "border", emoji: "ðŸŒŒ", probability: 0.25, rarity: "legendary"},
                {item: "500 Bonus Points", type: "points", emoji: "ðŸ’µ", value: 500, probability: 0.20, rarity: "legendary"},
                {item: "Divine Title", type: "title", emoji: "âœ¨", probability: 0.15, rarity: "legendary"},
                {item: "Ultimate Pack", type: "ultimate_pack", emoji: "ðŸŽª", probability: 0.08, rarity: "mythic"},
                {item: "MEGA JACKPOT 5000 Points", type: "points", emoji: "ðŸ…", value: 5000, probability: 0.02, rarity: "mythic"}
            ]
        }
    };

    // Initialize coins
    let coins = parseInt(localStorage.getItem('coins')) || 100; // Start with 100 coins for demo
    let ownedItems = JSON.parse(localStorage.getItem('ownedItems')) || [];
    let equippedAvatar = localStorage.getItem('equippedAvatar') || 'ðŸ‘¤';
    let equippedTitle = localStorage.getItem('equippedTitle') || '';

    // Update coin display
    function updateCoins() {
        document.getElementById('coin-count').textContent = coins;
        document.getElementById('shop-coin-count').textContent = coins;
        localStorage.setItem('coins', coins);
    }

    // Update avatar and title display
    function updateProfile() {
        document.getElementById('user-avatar').textContent = equippedAvatar;
        document.getElementById('user-title').textContent = equippedTitle;
    }

    // Login functionality
    document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const errorMessage = document.getElementById('error-message');
        
        if (username && password) {
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
            document.getElementById('user_status').textContent = 'Welcome, ' + username + '!';
            
            updateCoins();
            updateProfile();
            loadQuests();
        } else {
            errorMessage.textContent = 'Please enter both username and password';
        }
    });

    // Logout functionality
    document.getElementById('logout-btn').addEventListener('click', function() {
        document.getElementById('login-page').style.display = 'block';
        document.getElementById('main-content').style.display = 'none';
        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
        document.getElementById('error-message').textContent = '';
    });

    // Signup link
    document.getElementById('signup-link').addEventListener('click', function(e) {
        e.preventDefault();
        alert('Signup functionality coming soon!');
    });

    // Shop modal functionality
    document.getElementById('shop-btn').addEventListener('click', function() {
        document.getElementById('shop-modal').style.display = 'block';
        loadShop();
    });

    document.getElementById('shop-close').addEventListener('click', function() {
        document.getElementById('shop-modal').style.display = 'none';
    });

    window.addEventListener('click', function(event) {
        if (event.target == document.getElementById('shop-modal')) {
            document.getElementById('shop-modal').style.display = 'none';
        }
    });

    // Load quests from mock data
    function loadQuests() {
        const questList = document.getElementById('quest-list');
        questList.innerHTML = '';
        
        MOCK_QUESTS.forEach(quest => {
            const questCard = document.createElement('div');
            questCard.className = 'quest-card';
            questCard.setAttribute('data-quest-id', quest.quest_id);
            
            const isCompleted = localStorage.getItem('quest_' + quest.quest_id) === 'completed';
            
            questCard.innerHTML = `
                <div>
                    <span class="quest-category category-${quest.category}">${quest.category}</span>
                    <span class="quest-status ${isCompleted ? 'completed' : quest.status}">
                        ${isCompleted ? 'COMPLETED' : quest.status.toUpperCase()}
                    </span>
                </div>
                <div class="quest-title">${quest.title}</div>
                <div class="quest-description">${quest.description}</div>
                <button class="complete-btn" onclick="completeQuest(${quest.quest_id})" ${isCompleted ? 'disabled' : ''}>
                    ${isCompleted ? 'âœ“ Completed' : 'Mark as Complete'}
                </button>
            `;
            questList.appendChild(questCard);
        });
    }

    // Complete a quest
    function completeQuest(questId) {
        localStorage.setItem('quest_' + questId, 'completed');
        const questCard = document.querySelector(`[data-quest-id="${questId}"]`);
        const statusSpan = questCard.querySelector('.quest-status');
        const completeBtn = questCard.querySelector('.complete-btn');
        
        statusSpan.className = 'quest-status completed';
        statusSpan.textContent = 'COMPLETED';
        completeBtn.disabled = true;
        completeBtn.textContent = 'âœ“ Completed';
        
        // Award coins for completing quest
        const coinsEarned = 10;
        coins += coinsEarned;
        updateCoins();
        
        // Show celebration message
        const celebration = document.createElement('div');
        celebration.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #4caf50; color: white; padding: 20px 40px; border-radius: 10px; font-size: 24px; font-weight: bold; z-index: 1000;';
        celebration.innerHTML = `ðŸŽ‰ Quest Completed! ðŸŽ‰<br><span style="font-size: 18px;">+${coinsEarned} coins ðŸ’°</span>`;
        document.body.appendChild(celebration);
        
        setTimeout(() => {
            celebration.remove();
        }, 2500);
    }

    // Load shop items
    function loadShop() {
        renderShopItems(MOCK_SHOP.avatars, 'avatars-grid', 'avatar');
        renderShopItems(MOCK_SHOP.cosmetics, 'cosmetics-grid', 'cosmetic');
        renderCrateItems(MOCK_SHOP.vip_crates, 'crates-grid');
    }

    // Render VIP crate items
    function renderCrateItems(crates, containerId) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';
        
        crates.forEach(crate => {
            const crateDiv = document.createElement('div');
            crateDiv.className = 'shop-item';
            
            crateDiv.innerHTML = `
                <div class="shop-item-emoji">${crate.emoji}</div>
                <div class="shop-item-name">${crate.name}</div>
                <div style="font-size: 12px; color: #ff9800; margin: 5px 0;">VIP ${crate.vip_required}+ Required</div>
                <div class="shop-item-price">${crate.price} coins</div>
                <div style="font-size: 11px; color: #666; margin-top: 5px;">${crate.description}</div>
                <button class="buy-btn" onclick="openCrate('${crate.id}', ${crate.price})">Open Crate</button>
            `;
            
            container.appendChild(crateDiv);
        });
    }

    // Open a crate - Uses probability-based reward system from VIP_CRATES
    function openCrate(crateId, price) {
        if (coins < price) {
            alert('Not enough coins! You need ' + price + ' coins to open this crate.');
            return;
        }
        
        coins -= price;
        updateCoins();
        
        // Get crate rewards
        const crateData = VIP_CRATES[crateId];
        if (!crateData) {
            alert('Invalid crate!');
            coins += price; // Refund
            updateCoins();
            return;
        }
        
        // Select reward based on probability (same logic as quest_board.py)
        const rewards = crateData.rewards;
        const randomValue = Math.random();
        let cumulativeProbability = 0.0;
        let selectedReward = rewards[rewards.length - 1]; // Fallback to last reward
        
        for (const reward of rewards) {
            cumulativeProbability += reward.probability;
            if (randomValue <= cumulativeProbability) {
                selectedReward = reward;
                break;
            }
        }
        
        // If reward is points, add them
        if (selectedReward.type === 'points' && selectedReward.value) {
            coins += selectedReward.value;
            updateCoins();
        }
        
        // Rarity colors
        const rarityColors = {
            'common': '#9e9e9e',
            'uncommon': '#4caf50',
            'rare': '#2196f3',
            'epic': '#9c27b0',
            'legendary': '#ff9800',
            'mythic': '#f44336'
        };
        
        // Show reward animation
        const rewardDiv = document.createElement('div');
        rewardDiv.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 60px;
            border-radius: 15px;
            font-size: 24px;
            font-weight: bold;
            z-index: 2000;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        `;
        
        rewardDiv.innerHTML = `
            <div style="font-size: 64px; margin-bottom: 20px;">${selectedReward.emoji}</div>
            <div style="font-size: 28px; margin-bottom: 10px;">${selectedReward.item}</div>
            <div style="font-size: 16px; color: ${rarityColors[selectedReward.rarity]}; text-transform: uppercase; letter-spacing: 2px;">
                ${selectedReward.rarity}
            </div>
            ${selectedReward.type === 'points' && selectedReward.value ? `<div style="font-size: 20px; margin-top: 15px;">+${selectedReward.value} coins ðŸ’°</div>` : ''}
        `;
        
        document.body.appendChild(rewardDiv);
        
        setTimeout(() => {
            rewardDiv.remove();
        }, 3500);
    }

    // Render shop items
    function renderShopItems(items, containerId, itemType) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';
        
        items.forEach(item => {
            const owned = ownedItems.includes(item.id);
            const equipped = (itemType === 'avatar' && equippedAvatar === item.emoji) ||
                            (item.type === 'title' && equippedTitle === item.emoji + ' ' + item.name);
            
            const itemDiv = document.createElement('div');
            itemDiv.className = 'shop-item' + (owned ? ' owned' : '') + (equipped ? ' equipped' : '');
            
            let buttonHTML = '';
            if (!owned) {
                buttonHTML = `<button class="buy-btn" onclick="buyItem('${item.id}', ${item.price}, '${itemType}', '${item.emoji}', '${item.name}', '${item.type}')">Buy - ${item.price} ðŸ’°</button>`;
            } else if (!equipped && (itemType === 'avatar' || item.type === 'title')) {
                buttonHTML = `<button class="equip-btn" onclick="equipItem('${item.id}', '${item.emoji}', '${item.name}', '${item.type}')">Equip</button>`;
            } else if (equipped) {
                buttonHTML = `<button class="equip-btn" disabled>Equipped âœ“</button>`;
            } else {
                buttonHTML = `<button class="buy-btn" disabled>Owned âœ“</button>`;
            }
            
            itemDiv.innerHTML = `
                <div class="shop-item-emoji">${item.emoji}</div>
                <div class="shop-item-name">${item.name}</div>
                <div class="shop-item-price">${owned ? 'Owned' : item.price + ' coins'}</div>
                ${buttonHTML}
            `;
            
            container.appendChild(itemDiv);
        });
    }

    // Buy item
    function buyItem(itemId, price, itemType, emoji, name, type) {
        if (coins >= price) {
            coins -= price;
            ownedItems.push(itemId);
            localStorage.setItem('coins', coins);
            localStorage.setItem('ownedItems', JSON.stringify(ownedItems));
            updateCoins();
            loadShop();
            
            const message = document.createElement('div');
            message.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #4caf50; color: white; padding: 20px 40px; border-radius: 10px; font-size: 20px; font-weight: bold; z-index: 2000;';
            message.textContent = 'âœ“ Purchase Successful!';
            document.body.appendChild(message);
            
            setTimeout(() => {
                message.remove();
            }, 1500);
        } else {
            alert('Not enough coins! Complete more quests to earn coins.');
        }
    }

    // Equip item
    function equipItem(itemId, emoji, name, type) {
        if (type === 'avatar') {
            equippedAvatar = emoji;
            localStorage.setItem('equippedAvatar', emoji);
        } else if (type === 'title') {
            equippedTitle = emoji + ' ' + name;
            localStorage.setItem('equippedTitle', equippedTitle);
        }
        updateProfile();
        loadShop();
    }

    // Refresh quests button
    document.getElementById('refresh-quests').addEventListener('click', function() {
        Object.keys(localStorage).forEach(key => {
            if (key.startsWith('quest_')) {
                localStorage.removeItem(key);
            }
        });
        loadQuests();
    });
</script>

</body>
</html>